{% macro render_list_view(items, endpoint, sort_by, sort_order, current_folder_id) %}
<table class="table table-hover table-list-view">
    <thead>
        <tr>
            <th style="width: 5%;"><input type="checkbox" id="selectAll"></th>
            <th style="width: 45%;">
                {% set args = request.args.to_dict() %}
                {% do args.update({'sort_by': 'name', 'sort_order': 'asc' if sort_by != 'name' or sort_order == 'desc' else 'desc', 'folder_id': current_folder_id}) %}
                <a href="{{ url_for(endpoint, **args) }}">Name</a>
            </th>
            <th style="width: 5%;">
                {% set args = request.args.to_dict() %}
                {% do args.update({'sort_by': 'type', 'sort_order': 'asc' if sort_by != 'type' or sort_order == 'desc' else 'desc', 'folder_id': current_folder_id}) %}
                <a href="{{ url_for(endpoint, **args) }}">Type</a>
            </th>
            <th style="width: 5%;">
                {% set args = request.args.to_dict() %}
                {% do args.update({'sort_by': 'size', 'sort_order': 'asc' if sort_by != 'size' or sort_order == 'desc' else 'desc', 'folder_id': current_folder_id}) %}
                <a href="{{ url_for(endpoint, **args) }}">Size</a>
            </th>
            <th style="width: 15%;">
                {% set args = request.args.to_dict() %}
                {% do args.update({'sort_by': 'date', 'sort_order': 'asc' if sort_by != 'date' or sort_order == 'desc' else 'desc', 'folder_id': current_folder_id}) %}
                <a href="{{ url_for(endpoint, **args) }}">Date Modified</a>
            </th>
            <th style="width: 10%;">
                {% set args = request.args.to_dict() %}
                {% do args.update({'sort_by': 'folder', 'sort_order': 'asc' if sort_by != 'folder' or sort_order == 'desc' else 'desc', 'folder_id': current_folder_id}) %}
                <a href="{{ url_for(endpoint, **args) }}">Folder</a>
            </th>
            <th style="width: 7%;">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for item_wrapper in items %}
        {% set item = item_wrapper.obj %}
        {% if item_wrapper.type == 'folder' %}
        <tr class="folder-row" data-folder-path="{{ item.id }}">
            <td><input type="checkbox" class="item-checkbox" value="{{ item.id }}" data-item-type="folder" data-item-id="{{ item.id }}" data-item-name="{{ item.folder | basename }}"></td>
            <td class="td-name">
                <a href="{{ url_for('views.folders', folder_id=item.id, view_mode=request.args.get('view_mode') or 'list', per_page=request.args.get('per_page') or '20', sort_by=request.args.get('sort_by'), sort_order=request.args.get('sort_order')) }}" class="d-flex align-items-center">
                    <i class="fas fa-folder" style="font-size: 2rem; margin-right: 10px;"></i>
                    <span title="{{ item.folder | basename }}">{{ item.folder | basename }}</span>
                </a>
            </td>
            <td class="td-type">Folder</td>
            <td class="td-size">--</td>
            <td class="td-date">--</td>
            <td class="td-folder">{{ item.folder | basename }}</td>
            <td class="td-actions">
                <div class="btn-group-vertical">
                    <button class="btn btn-sm btn-primary rename-btn mb-1" data-bs-toggle="modal" data-bs-target="#renameModal" data-item-id="{{ item.id }}" data-item-name="{{ item.folder | basename }}" data-item-type="folder" title="Rename"><i class="bi bi-pencil"></i></button>
                    <button class="btn btn-sm btn-danger delete-btn mb-1" data-bs-toggle="modal" data-bs-target="#deleteModal" data-item-id="{{ item.id }}" data-item-name="{{ item.folder | basename }}" data-item-type="folder" title="Delete"><i class="bi bi-trash"></i></button>
                    <button class="btn btn-sm btn-info clear-cache-btn" data-item-id="{{ item.id }}" data-item-type="folder" title="Clear Cache"><i class="bi bi-eraser"></i></button>
                </div>
            </td>
        </tr>
        {% else %}
        <tr class="file-row" data-file-id="{{ item.id }}">
            <td><input type="checkbox" class="item-checkbox" value="{{ item.id }}" data-item-type="file" data-item-id="{{ item.id }}" data-item-name="{{ item.filename }}" data-telegram-file-id="{{ item.file_id }}"></td>
            <td class="td-name">
                <a href="{{ url_for('views.preview_file', db_id=item.id) }}" target="_blank" class="d-flex align-items-center">
                    {% if item.thumbnail_file_id %}
                        <img src="{{ url_for('views.get_thumbnail', thumbnail_file_id=item.thumbnail_file_id) }}" alt="Thumbnail" style="width: 50px; height: 50px; object-fit: cover; margin-right: 10px;">
                    {% else %}
                        <i class="fas fa-file" style="font-size: 2rem; margin-right: 10px;"></i>
                    {% endif %}
                    <span title="{{ item.filename }}">{{ item.filename }}</span>
                </a>
            </td>
            <td class="td-type">{{ item.mime_type }}</td>
            <td class="td-size">{{ item.size | format_size }}</td>
            <td class="td-date">{{ item.upload_date.strftime('%Y-%m-%d %H:%M:%S') if item.upload_date else "N/A" }}</td>
            <td class="td-folder">{{ item.folder }}</td>
            <td class="td-actions">
                <div class="btn-group-vertical">
                    {% if item.message_link %}<a href="{{ item.message_link }}" target="_blank" class="btn btn-sm btn-secondary mb-1" title="View in Telegram"><i class="bi bi-send"></i></a>{% endif %}
                    <button class="btn btn-sm btn-primary rename-btn mb-1" data-bs-toggle="modal" data-bs-target="#renameModal" data-item-id="{{ item.id }}" data-item-name="{{ item.filename }}" data-item-type="file" title="Rename"><i class="bi bi-pencil"></i></button>
                    <button class="btn btn-sm btn-danger delete-btn" data-bs-toggle="modal" data-bs-target="#deleteModal" data-item-id="{{ item.id }}" data-item-name="{{ item.filename }}" data-item-type="file" title="Delete"><i class="bi bi-trash"></i></button>
                </div>
            </td>
        </tr>
        {% endif %}
        {% endfor %}
    </tbody>
</table>
{% endmacro %}

{% macro render_grid_view(items) %}
<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3">
    {% for item_wrapper in items %}
    {% set item = item_wrapper.obj %}
    <div class="col">
        <div class="card h-100">
            {% if item_wrapper.type == 'folder' %}
                <a href="{{ url_for('views.folders', folder_id=item.id, view_mode=request.args.get('view_mode') or 'grid', per_page=request.args.get('per_page') or '20') }}" class="text-decoration-none text-center">
                    <div class="card-img-top-container text-center p-2">
                        <input type="checkbox" class="form-check-input item-checkbox" data-item-type="folder" data-item-id="{{ item.id }}" data-item-name="{{ item.folder | basename }}">
                        <i class="bi bi-folder-fill" style="font-size: 4rem; color: #5bc0de;"></i>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title text-truncate">{{ item.folder | basename }}</h6>
                        <p class="card-text text-muted small mb-0">Type: Folder</p>
                        <p class="card-text text-muted small mb-0">Size: --</p>
                        <p class="card-text text-muted small">Upload Date: --</p>
                    </div>
                </a>
                <div class="card-footer text-center">
                    <div class="btn-group action-buttons">
                        <button type="button" class="btn btn-sm btn-primary rename-btn" data-bs-toggle="modal" data-bs-target="#renameModal" data-item-type="folder" data-old-name="{{ item.folder | basename }}" data-item-id="{{ item.id }}" title="Rename"><i class="bi bi-pencil"></i></button>
                        <button type="button" class="btn btn-sm btn-danger delete-btn" data-bs-toggle="modal" data-bs-target="#deleteModal" data-item-id="{{ item.id }}" data-item-name="{{ item.folder | basename }}" data-item-type="folder" title="Delete"><i class="bi bi-trash"></i></button>
                    </div>
                </div>
            {% else %}
                <a href="{{ url_for('views.preview_file', db_id=item.id) }}" target="_blank" class="text-decoration-none">
                    <div class="card-img-top-container text-center p-2">
                        <input type="checkbox" class="form-check-input item-checkbox" data-item-type="file" data-item-id="{{ item.id }}" data-telegram-file-id="{{ item.file_id }}">
                        {% if item.thumbnail_file_id %}
                            <img src="{{ url_for('views.get_thumbnail', thumbnail_file_id=item.thumbnail_file_id) }}" class="card-img-top" alt="Thumbnail" style="height: 150px; object-fit: contain;">
                        {% else %}
                            <i class="bi bi-file-earmark" style="font-size: 4rem;"></i>
                        {% endif %}
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title text-truncate">{{ item.filename }}</h6>
                        <p class="card-text text-muted small mb-0">Type: {{ item.mime_type or "N/A" }}</p>
                        <p class="card-text text-muted small mb-0">Size: {{ item.size | format_size or "N/A" }}</p>
                        <p class="card-text text-muted small">Upload Date: {{ item.upload_date.strftime('%Y-%m-%d %H:%M:%S') if item.upload_date else "N/A" }}</p>
                    </div>
                </a>
                <div class="card-footer text-center">
                    <div class="btn-group action-buttons">
                        {% if item.message_link %}<a href="{{ item.message_link }}" target="_blank" class="btn btn-sm btn-secondary" title="View in Telegram" onclick="event.stopPropagation();"><i class="bi bi-send"></i></a>{% endif %}
                        <button type="button" class="btn btn-sm btn-primary rename-btn" data-bs-toggle="modal" data-bs-target="#renameModal" data-item-type="file" data-old-name="{{ item.filename }}" data-item-id="{{ item.id }}" title="Rename"><i class="bi bi-pencil"></i></button>
                        <button type="button" class="btn btn-sm btn-danger delete-btn" data-bs-toggle="modal" data-bs-target="#deleteModal" data-item-id="{{ item.id }}" data-item-name="{{ item.filename }}" data-item-type="file" title="Delete"><i class="bi bi-trash"></i></button>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% endmacro %}

{% macro render_gallery_view(items, is_recycle_bin=False) %}
<div class="photo-gallery">
    {% for item_wrapper in items %}
    {% set item = item_wrapper.obj %}
        <div class="gallery-item-container">
            {% if item_wrapper.type == 'folder' %}
                <div class="gallery-item folder-item">
                    <input type="checkbox" class="form-check-input item-checkbox" data-item-type="folder" data-item-id="{{ item.id }}" data-item-name="{{ item.folder | basename }}" value="{{ item.id }}">
                    <a href="{{ url_for('views.folders', folder_id=item.id, view_mode=request.args.get('view_mode') or 'gallery', per_page=request.args.get('per_page') or '20') }}" class="text-decoration-none">
                        <div class="gallery-thumbnail">
                            <i class="bi bi-folder-fill" style="font-size: 5rem; color: #5bc0de;"></i>
                        </div>
                        <div class="file-name-overlay">{{ item.folder | basename }}</div>
                    </a>
                </div>
            {% elif item.mime_type and (item.mime_type.startswith('image/') or item.thumbnail_file_id) %}
                {% set is_video = item.mime_type.startswith('video/') %}
                <div class="gallery-item {% if is_video %}video-item{% endif %}">
                    <input type="checkbox" class="form-check-input item-checkbox" value="{{ item.id }}" data-item-type="file" data-item-id="{{ item.id }}" data-item-name="{{ item.filename }}" data-telegram-file-id="{{ item.file_id }}">
                    <div class="gallery-image-content" 
                         data-bs-toggle="modal" 
                         data-bs-target="#galleryActionModal" 
                         data-preview-url="{{ url_for('views.preview_file', db_id=item.id) }}" 
                         data-telegram-link="{{ item.message_link if item.message_link else 'None' }}"
                         style="cursor: pointer;">
                        {% if item.thumbnail_file_id %}
                            <img src="{{ url_for('views.get_thumbnail', thumbnail_file_id=item.thumbnail_file_id) }}" alt="{{ item.filename }}">
                        {% else %}
                            <i class="bi bi-file-earmark" style="font-size: 5rem;"></i>
                        {% endif %}
                        <div class="file-name-overlay">{{ item.filename }}</div>
                    </div>
                </div>
            {% endif %}
        </div>
    {% endfor %}
</div>
{% endmacro %}
