<script>
    document.addEventListener('DOMContentLoaded', function() {
        const selectAllCheckbox = document.getElementById('selectAll');
        const itemCheckboxes = document.querySelectorAll('.item-checkbox');
        const restoreSelectedBtn = document.getElementById('restoreSelectedBtn');
        const permanentDeleteSelectedBtn = document.getElementById('permanentDeleteSelectedBtn');
        const recycleBinForm = document.getElementById('recycleBinForm');

        function updateButtonStates() {
            const hasChecked = Array.from(itemCheckboxes).some(cb => cb.checked);
            restoreSelectedBtn.disabled = !hasChecked;
            permanentDeleteSelectedBtn.disabled = !hasChecked;
        }

        selectAllCheckbox.addEventListener('change', function() {
            itemCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            updateButtonStates();
        });

        itemCheckboxes.forEach(checkbox => {
            checkbox.addEventListener('change', updateButtonStates);
        });

        function createAndSubmitForm(actionUrl, confirmationMessage) {
            if (confirm(confirmationMessage)) {
                const selectedItems = Array.from(itemCheckboxes)
                    .filter(cb => cb.checked)
                    .map(cb => ({
                        id: parseInt(cb.value),
                        type: cb.dataset.itemType
                    }));
                
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = actionUrl;

                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'item_ids';
                input.value = JSON.stringify(selectedItems);
                form.appendChild(input);

                document.body.appendChild(form);
                form.submit();
            }
        }

        restoreSelectedBtn.addEventListener('click', function(event) {
            event.preventDefault();
            createAndSubmitForm("{{ url_for('restore_items_route') }}", 'Are you sure you want to restore the selected items?');
        });

        permanentDeleteSelectedBtn.addEventListener('click', function(event) {
            event.preventDefault();
            createAndSubmitForm("{{ url_for('permanent_delete_items_route') }}", 'Are you sure you want to permanently delete the selected items? This action cannot be undone.');
        });

        updateButtonStates(); // Initial state
    });
</script>